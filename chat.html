<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Live Terminal Chat</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- Top navigation links -->
  <div class="top-links-wrapper">
    <div class="top-links-inner">
      <a href="#" class="top-link">[ DEX ]</a>
      <a href="https://x.com/MonetizedMNDSHR" class="top-link" target="_blank">[ X ]</a>
    </div>
  </div>
  
  <!-- Chat display area -->
  <div class="chat-wrapper">
    <div id="chat"></div>
  </div>

  <!-- Fixed input field styled like "Continue" button -->
  <input id="messageInput" type="text" placeholder="> Type your message..." autocomplete="off" />

  <!-- Pusher client -->
  <script src="https://js.pusher.com/7.2/pusher.min.js"></script>

  <script>
    const chat = document.getElementById('chat');
    const input = document.getElementById('messageInput');

    // Send message to API endpoint on Enter key
    input.addEventListener('keydown', async function (e) {
      if (e.key === 'Enter' && input.value.trim() !== '') {
        const message = input.value.trim();
        input.value = '';

        try {
          const res = await fetch('/api/send-message', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message })
          });

          if (!res.ok) {
            console.error('Failed to send message');
          }
        } catch (err) {
          console.error('Request error:', err);
        }
      }
    });

    // Pusher subscription and event handling
    const pusher = new Pusher('22541ed2a8183729f691', {
      cluster: 'us2'
    });

    const channel = pusher.subscribe('chat-channel');
    channel.bind('chat-event', function(data) {
      const isScrolledToBottom =
        chat.scrollHeight - chat.clientHeight <= chat.scrollTop + 5;

      const msgElement = document.createElement('div');
      msgElement.textContent = data.message;
      chat.appendChild(msgElement);

      if (isScrolledToBottom) {
        chat.scrollTop = chat.scrollHeight;
      }
    });
  </script>

</body>
</html>
